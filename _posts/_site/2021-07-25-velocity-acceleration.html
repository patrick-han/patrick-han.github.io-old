<ul id="markdown-toc">
  <li><a href="#速度向量" id="markdown-toc-速度向量">速度向量</a>    <ul>
      <li><a href="#匀速直线运动" id="markdown-toc-匀速直线运动">匀速直线运动</a>        <ul>
          <li><a href="#已知xy分速度的运动" id="markdown-toc-已知xy分速度的运动">已知x、y分速度的运动</a></li>
          <li><a href="#基于速度向量的运动" id="markdown-toc-基于速度向量的运动">基于速度向量的运动</a></li>
          <li><a href="#基于每帧时间间隔的实现" id="markdown-toc-基于每帧时间间隔的实现">基于每帧时间间隔的实现</a></li>
        </ul>
      </li>
      <li><a href="#移动到点击位置" id="markdown-toc-移动到点击位置">移动到点击位置</a></li>
      <li><a href="#总是跟随鼠标的箭头" id="markdown-toc-总是跟随鼠标的箭头">总是跟随鼠标的箭头</a></li>
    </ul>
  </li>
  <li><a href="#加速度" id="markdown-toc-加速度">加速度</a>    <ul>
      <li><a href="#基于连续时间的加速度" id="markdown-toc-基于连续时间的加速度">基于连续时间的加速度</a></li>
      <li><a href="#基于每帧间隔时间的加速运动" id="markdown-toc-基于每帧间隔时间的加速运动">基于每帧间隔时间的加速运动</a></li>
      <li><a href="#使用方向键控制小球加速" id="markdown-toc-使用方向键控制小球加速">使用方向键控制小球加速</a>        <ul>
          <li><a href="#添加重力加速度" id="markdown-toc-添加重力加速度">添加重力加速度</a></li>
        </ul>
      </li>
      <li><a href="#宇宙飞船" id="markdown-toc-宇宙飞船">宇宙飞船</a></li>
    </ul>
  </li>
  <li><a href="#总结" id="markdown-toc-总结">总结</a></li>
</ul>

<p>本文将开始讲述动画编程的部分，会从基本的运动属性开始：速度、向量和加速度</p>

<ul>
  <li>速度</li>
  <li>加速度</li>
</ul>

<h1 id="速度向量">速度向量</h1>

<p>速度向量指某个方向上的速度。这里包含速度的值和方向（既有大小，又有方向）。</p>

<p>任何一个速度向量又可以被分解为 x 方向和 y 方向。</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01WPKEIm1RfFU3WNga3_!!6000000002138-2-tps-233-197.png" alt="" /></p>

<p>接下来的示例中，我们会使用 vx 表示 x 轴上的速度向量，vy 表示 y 轴上的速度向量。</p>

<h2 id="匀速直线运动">匀速直线运动</h2>

<p>匀速直线运动是指运动快慢不变（即速度不变）、沿着直线的运动。在匀速直线运动中，路程与时间成正比，用公式 s=vt 计算。</p>

\[s = vt\]

<p>这里复用《动画中的三角学》一文中创建的 Ball 类，进行小球的匀速直线运动示例</p>

<h3 id="已知xy分速度的运动">已知x、y分速度的运动</h3>

<p>代码如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">vx</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">// x 方向速度， 10 像素/s</span>
<span class="kd">const</span> <span class="nx">vy</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">// y 方向速度， 20 像素/s</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="mi">20</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vx</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">x0</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vy</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">y0</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>核心代码为</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vx</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">x0</span>
<span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vy</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">y0</span>
</code></pre></div></div>

<p>效果如下</p>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01MpcTv41Ul9QwSjb1d_!!6000000002557-1-tps-386-416.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/17-uniform-linear-motion/">https://gaohaoyang.github.io/canvas-practice/17-uniform-linear-motion/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/17-uniform-linear-motion/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/17-uniform-linear-motion/index.ts</a></p>

<h3 id="基于速度向量的运动">基于速度向量的运动</h3>

<p>上述是通过速度的分量 vx 和 vy 进行计算的，如果未知速度的分量，只知道小球延45度每秒10像素运动，该如何实现呢？这就用到了三角函数，不清楚三角函数的可以回顾之前的文章《动画中的三角学》。</p>

<p><img src="https://gw.alicdn.com/imgextra/i2/O1CN01tpYtrv1rnCMsinvlZ_!!6000000005675-2-tps-133-133.png" alt="" /></p>

<p>其分量为</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vx = 10 * cos(45)
vy = 10 * sin(45)
</code></pre></div></div>

<p>所以完整代码如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">alpha</span> <span class="o">=</span> <span class="mi">45</span> <span class="c1">// 角度 45 度</span>
<span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">// 速度， 10 像素/s</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="mi">20</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">x0</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">y0</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01OP2dne1CPw06KjJUq_!!6000000000074-1-tps-386-416.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/18-uniform-linear-motion2/">https://gaohaoyang.github.io/canvas-practice/18-uniform-linear-motion2/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/18-uniform-linear-motion2/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/18-uniform-linear-motion2/index.ts</a></p>

<p>注意这里的 <code class="language-plaintext highlighter-rouge">timeInSeconds</code> 是一个连续的时间，在 canvas 绘图中可能会经常使用每一帧的时间片段来进行计算，接下来讲到。</p>

<h3 id="基于每帧时间间隔的实现">基于每帧时间间隔的实现</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">alpha</span> <span class="o">=</span> <span class="mi">45</span> <span class="c1">// 角度 45 度</span>
<span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">// 速度， 10 像素/s</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="mi">20</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x0</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y0</span>

  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>效果与上一个 demo 相同，这里的核心逻辑为</p>

<p>每次计算每帧内的位移，再进行累加</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTime</span>
<span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTime</span>
</code></pre></div></div>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/19-uniform-linear-frame-time/">https://gaohaoyang.github.io/canvas-practice/19-uniform-linear-frame-time/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/19-uniform-linear-frame-time/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/19-uniform-linear-frame-time/index.ts</a></p>

<h2 id="移动到点击位置">移动到点击位置</h2>

<p>在《动画中的三角学》一文中，我们实现了总是指向鼠标的箭头，现在我们将其稍加改造，改为总是移动到点击位置。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Arrow</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Arrow</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">// 速度 10 像素/s</span>

<span class="cm">/**
 * 获取鼠标点击位置
 */</span>
<span class="kd">const</span> <span class="nx">getClickPos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">:</span> <span class="nx">HTMLElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="nx">element</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="na">e</span><span class="p">:</span> <span class="nx">MouseEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="nx">pos</span>
<span class="p">}</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Arrow</span><span class="p">()</span>
  <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>

  <span class="kd">const</span> <span class="nx">mousePos</span> <span class="o">=</span> <span class="nf">getClickPos</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>

  <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTimeInSeconds</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span> <span class="c1">// 每帧的间隔时间，单位s</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span>
      <span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span>
      <span class="kd">const</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">atan2</span><span class="p">(</span><span class="nx">dy</span><span class="p">,</span> <span class="nx">dx</span><span class="p">)</span>

      <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTimeInSeconds</span>
      <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTimeInSeconds</span>
      <span class="nx">arrow</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">=</span> <span class="nx">angle</span>

      <span class="nx">arrow</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01gJ80VJ1rJQckivf2K_!!6000000005610-1-tps-386-416.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/20-arrow-to-tap/">https://gaohaoyang.github.io/canvas-practice/20-arrow-to-tap/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/20-arrow-to-tap/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/20-arrow-to-tap/index.ts</a></p>

<h2 id="总是跟随鼠标的箭头">总是跟随鼠标的箭头</h2>

<p>要实现这个demo，只需将上述的点击事件换为 mousemove 事件即可</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Arrow</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Arrow</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">captureMouse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/utils</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">// 速度 10 像素/s</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Arrow</span><span class="p">()</span>
  <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>

  <span class="kd">const</span> <span class="nx">mousePos</span> <span class="o">=</span> <span class="nf">captureMouse</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>

  <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTimeInSeconds</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span> <span class="c1">// 每帧的间隔时间，单位s</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span>
      <span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span>
      <span class="kd">const</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">atan2</span><span class="p">(</span><span class="nx">dy</span><span class="p">,</span> <span class="nx">dx</span><span class="p">)</span>

      <span class="nx">arrow</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTimeInSeconds</span>
      <span class="nx">arrow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span> <span class="o">*</span> <span class="nx">deltaTimeInSeconds</span>
      <span class="nx">arrow</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">=</span> <span class="nx">angle</span>

      <span class="nx">arrow</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01N54hn51LLeqZXexj4_!!6000000001283-1-tps-637-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/21-arrow-to-mouse-move/">https://gaohaoyang.github.io/canvas-practice/21-arrow-to-mouse-move/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/21-arrow-to-mouse-move/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/21-arrow-to-mouse-move/index.ts</a></p>

<h1 id="加速度">加速度</h1>

<p>中学物理中，加速运动的位移一般是通过连续时间变量来计算的，但 canvas 绘图中我们更多的是使用每一帧之间的时间片段。我们先回顾一下基于连续时间的加速度。</p>
<h2 id="基于连续时间的加速度">基于连续时间的加速度</h2>

<p>匀加速直线运动的速度公式</p>

\[v_t = v_0 + at\]

<p>匀加速直线运动的位移公式</p>

\[x = \dfrac{v_0+v_t}{2}t = v_0t + \dfrac{1}{2}at^2\]

<p>示例</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">v0x</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">const</span> <span class="nx">v0y</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">const</span> <span class="nx">ax</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向加速度， 单位 像素/s^2</span>
<span class="kd">const</span> <span class="nx">ay</span> <span class="o">=</span> <span class="mi">600</span> <span class="c1">// y 方向加速度， 单位 像素/s^2</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="mi">20</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">v0x</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ax</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">x0</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">v0y</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ay</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">y0</span>

      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>效果如下</p>

<p><img src="https://gw.alicdn.com/imgextra/i2/O1CN01XzDaWR1iPXMkVGGS8_!!6000000004405-1-tps-655-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/22-accelerate/">https://gaohaoyang.github.io/canvas-practice/22-accelerate/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/22-accelerate/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/22-accelerate/index.ts</a></p>

<h2 id="基于每帧间隔时间的加速运动">基于每帧间隔时间的加速运动</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">v0x</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">const</span> <span class="nx">v0y</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">const</span> <span class="nx">ax</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向加速度， 单位 像素/s^2</span>
<span class="kd">const</span> <span class="nx">ay</span> <span class="o">=</span> <span class="mi">600</span> <span class="c1">// y 方向加速度， 单位 像素/s^2</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="mi">20</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x0</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y0</span>
  <span class="kd">let</span> <span class="nx">vx</span> <span class="o">=</span> <span class="nx">v0x</span>
  <span class="kd">let</span> <span class="nx">vy</span> <span class="o">=</span> <span class="nx">v0y</span>

  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>

      <span class="nx">vx</span> <span class="o">+=</span> <span class="nx">ax</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">vy</span> <span class="o">+=</span> <span class="nx">ay</span> <span class="o">*</span> <span class="nx">deltaTime</span>

      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vx</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vy</span> <span class="o">*</span> <span class="nx">deltaTime</span>

      <span class="c1">// ball.x = v0x * timeInSeconds + (1 / 2) * ax * timeInSeconds ** 2 + x0</span>
      <span class="c1">// ball.y = v0y * timeInSeconds + (1 / 2) * ay * timeInSeconds ** 2 + y0</span>

      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i2/O1CN01zoFULK1Umz1Dcu23D_!!6000000002561-1-tps-655-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/23-accelerate-time/">https://gaohaoyang.github.io/canvas-practice/23-accelerate-time/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/23-accelerate-time/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/23-accelerate-time/index.ts</a></p>

<h2 id="使用方向键控制小球加速">使用方向键控制小球加速</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ball</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ball</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">v0x</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">const</span> <span class="nx">v0y</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向初速度， 单位 像素/s</span>
<span class="kd">let</span> <span class="nx">ax</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// x 方向加速度， 单位 像素/s^2</span>
<span class="kd">let</span> <span class="nx">ay</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// y 方向加速度， 单位 像素/s^2</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">KeyboardEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
    <span class="nf">switch </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowLeft</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">ax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowRight</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">ax</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowUp</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">ay</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowDown</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">ay</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">break</span>
      <span class="na">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyup</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">ay</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">})</span>

  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#1E88E5</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x0</span>
  <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y0</span>
  <span class="kd">let</span> <span class="nx">vx</span> <span class="o">=</span> <span class="nx">v0x</span>
  <span class="kd">let</span> <span class="nx">vy</span> <span class="o">=</span> <span class="nx">v0y</span>

  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>

      <span class="nx">vx</span> <span class="o">+=</span> <span class="nx">ax</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">vy</span> <span class="o">+=</span> <span class="nx">ay</span> <span class="o">*</span> <span class="nx">deltaTime</span>

      <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vx</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vy</span> <span class="o">*</span> <span class="nx">deltaTime</span>

      <span class="nx">ball</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01RaTyZG1dYd9JEIiDS_!!6000000003748-1-tps-655-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/24-ctrl-ball-accelerate/">https://gaohaoyang.github.io/canvas-practice/24-ctrl-ball-accelerate/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/24-ctrl-ball-accelerate/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/24-ctrl-ball-accelerate/index.ts</a></p>

<h3 id="添加重力加速度">添加重力加速度</h3>

<p>真实世界中，物体总是受到向下的重力，如果我们想模拟这个场景，只需要在上个示例中添加2行代码，让小球总有一个向下的加速度，如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="mi">50</span>

<span class="p">...</span>

<span class="nx">vy</span> <span class="o">+=</span> <span class="nx">gravity</span> <span class="o">*</span> <span class="nx">deltaTime</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN01LnDwrw1Wn6LsQ02gV_!!6000000002832-1-tps-655-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/25-ctrl-ball-accelerate-gravity/">https://gaohaoyang.github.io/canvas-practice/25-ctrl-ball-accelerate-gravity/</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/25-ctrl-ball-accelerate-gravity/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/25-ctrl-ball-accelerate-gravity/index.ts</a></p>

<h2 id="宇宙飞船">宇宙飞船</h2>

<p>使用本章前面学到的知识，实现一个模拟宇宙飞船正常飞行的能力吧</p>

<p>首先绘制宇宙飞船，新建一个 <code class="language-plaintext highlighter-rouge">Ship</code> 类，代码如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-disable no-param-reassign */</span>
<span class="kd">class</span> <span class="nc">Ship</span> <span class="p">{</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nx">width</span> <span class="o">=</span> <span class="mi">25</span>

  <span class="nx">height</span> <span class="o">=</span> <span class="mi">20</span>

  <span class="nx">rotation</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nx">showFlame</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="cm">/**
   * draw
   */</span>
  <span class="kr">public</span> <span class="nf">draw</span><span class="p">(</span><span class="nx">c</span><span class="p">:</span> <span class="nx">CanvasRenderingContext2D</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">save</span><span class="p">()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">translate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">rotate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rotation</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#ffffff</span><span class="dl">'</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">beginPath</span><span class="p">()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">stroke</span><span class="p">()</span>

    <span class="nf">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">showFlame</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">beginPath</span><span class="p">()</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span><span class="o">-</span><span class="mf">7.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="o">-</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">stroke</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nx">c</span><span class="p">.</span><span class="nf">restore</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Ship</span>
</code></pre></div></div>

<p>将其先绘制到 canvas 上看看</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Ship</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ship</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">ship</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ship</span><span class="p">()</span>
  <span class="nx">ship</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x0</span>
  <span class="nx">ship</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y0</span>

  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ship</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>效果如下</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01ZvIGVq1XWtxemEsoo_!!6000000002932-2-tps-1162-660.png" alt="" /></p>

<p>有喷射火焰时：</p>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN01bo4Qk51fiMnn7paOE_!!6000000004040-2-tps-1086-578.png" alt="" /></p>

<p>接下来写控制逻辑，飞船有3中控制方式左转、右转、点火，代码如下：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Ship</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/Ship</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">aRotation</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1">// 飞船旋转角加速度</span>
<span class="kd">const</span> <span class="nx">aThrust</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1">// 推进加速度</span>
<span class="kd">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1">// 初始位置</span>
<span class="kd">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span>

<span class="kd">let</span> <span class="nx">aRotationShip</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// 旋转角加速度</span>
<span class="kd">let</span> <span class="nx">vRotationShip</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// 旋转角速度</span>
<span class="kd">let</span> <span class="nx">aThrustShip</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// 推进加速度</span>
<span class="kd">let</span> <span class="nx">vThrustShip</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// 推进速度</span>

<span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

  <span class="kd">const</span> <span class="nx">ship</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Ship</span><span class="p">()</span>
  <span class="nx">ship</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x0</span>
  <span class="nx">ship</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y0</span>

  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">KeyboardEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
    <span class="nf">switch </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowLeft</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">aRotationShip</span> <span class="o">=</span> <span class="o">-</span><span class="nx">aRotation</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowRight</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">aRotationShip</span> <span class="o">=</span> <span class="nx">aRotation</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowUp</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">aThrustShip</span> <span class="o">=</span> <span class="nx">aThrust</span>
        <span class="nx">ship</span><span class="p">.</span><span class="nx">showFlame</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">break</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowDown</span><span class="dl">'</span><span class="p">:</span>
        <span class="nx">aThrustShip</span> <span class="o">=</span> <span class="o">-</span><span class="nx">aThrust</span>
        <span class="k">break</span>
      <span class="na">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyup</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">aRotationShip</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">aThrustShip</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">ship</span><span class="p">.</span><span class="nx">showFlame</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="p">})</span>

  <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">)</span>

  <span class="nf">if </span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">drawFrame</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">timeInSeconds</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">// 将毫秒转为秒单位</span>
      <span class="kd">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">timeInSeconds</span> <span class="o">-</span> <span class="nx">then</span>
      <span class="nx">then</span> <span class="o">=</span> <span class="nx">timeInSeconds</span>

      <span class="nx">context</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>

      <span class="nx">vRotationShip</span> <span class="o">+=</span> <span class="nx">aRotationShip</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nx">ship</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">vRotationShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span>

      <span class="nx">vThrustShip</span> <span class="o">+=</span> <span class="nx">aThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span>
      <span class="nf">if </span><span class="p">(</span><span class="nx">vThrustShip</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">vThrustShip</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">}</span>
      <span class="kd">const</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nx">ship</span><span class="p">.</span><span class="nx">rotation</span>
      <span class="nx">ship</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
      <span class="nx">ship</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>

      <span class="nx">ship</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>

      <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
      <span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">drawFrame</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">drawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01ykyUOq1ESniMhv3OO_!!6000000000351-1-tps-655-482.gif" alt="" /></p>

<p>demo 链接 <a href="https://gaohaoyang.github.io/canvas-practice/26-space-ship/index.html">https://gaohaoyang.github.io/canvas-practice/26-space-ship/index.html</a></p>

<p>源码链接 <a href="https://github.com/Gaohaoyang/canvas-practice/blob/main/src/26-space-ship/index.ts">https://github.com/Gaohaoyang/canvas-practice/blob/main/src/26-space-ship/index.ts</a></p>

<p>可以看到代码中先监听了键盘事件，将旋转角加速度常量值赋给真正飞船的旋转角加速度。然后根据角加速度算出飞船每帧的旋转角度</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vRotationShip</span> <span class="o">+=</span> <span class="nx">aRotationShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="c1">// 计算角速度</span>
<span class="nx">ship</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">vRotationShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span> <span class="c1">// 计算角度</span>
</code></pre></div></div>

<p>对于飞船喷射逻辑，我们也监听了键盘事件，将推进加速度常量赋值给飞船的推进加速度。然后通过飞船加速度计算得出飞船速度。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vThrustShip</span> <span class="o">+=</span> <span class="nx">aThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="c1">// 计算出飞船速度</span>
<span class="nf">if </span><span class="p">(</span><span class="nx">vThrustShip</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vThrustShip</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></div>

<p>注意这里我们增加了判断飞船可以一直减速，但不能倒退。然后再根据飞船的速度和角度，计算出飞船x、y方向上的位移</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nx">ship</span><span class="p">.</span><span class="nx">rotation</span>
<span class="nx">ship</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
<span class="nx">ship</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vThrustShip</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="总结">总结</h1>

<p>匀速直线运动</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s = v * t + s0 // 速度 乘 时间 加 初始位置
</code></pre></div></div>

<p>即</p>

\[s = vt\]

<p>获取速度分量的方式</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vx</span> <span class="o">=</span> <span class="nx">某个方向的速度</span> <span class="o">*</span> <span class="nf">cos</span><span class="p">(</span><span class="nx">该方向的角度</span><span class="p">)</span>
<span class="nx">vy</span> <span class="o">=</span> <span class="nx">某个方向的速度</span> <span class="o">*</span> <span class="nf">sin</span><span class="p">(</span><span class="nx">该方向的角度</span><span class="p">)</span>

<span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">x0</span>
<span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="nx">alpha</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="nx">timeInSeconds</span> <span class="o">+</span> <span class="nx">y0</span>
</code></pre></div></div>

<p>加速度</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">s</span> <span class="o">=</span> <span class="nx">v0</span> <span class="o">*</span> <span class="nx">t</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">t</span> <span class="o">^</span> <span class="mi">2</span>
</code></pre></div></div>

\[x = \dfrac{v_0+v_t}{2}t = v_0t + \dfrac{1}{2}at^2\]

<p>但在真正的动画开发中，经常会使用每帧的时间间隔来计算画面内物体的位移。这样做有2个好处</p>

<ol>
  <li>便于处理每帧内的实时变化，例如加速度改变、速度改变，直接得出当前帧内的位移情况，进行累加</li>
  <li>在不同刷新率的手机上，保证物体运动速度一致</li>
</ol>

<p>因此物体速度一般可以如下表示</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">deltaTime</span>
</code></pre></div></div>

<p>对于速度向量来说，可以使用三角函数进行计算物体的位移</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
<span class="nx">y</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
</code></pre></div></div>

<p>如果是加速运动，可以先算出通过加速度计算出速度，再使用速度计算出位移</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">v</span> <span class="o">+=</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">deltaTime</span>
<span class="nx">x</span> <span class="o">+=</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">deltaTime</span>
</code></pre></div></div>

<p>最后的宇宙飞船示例中，还引入了角加速度的概念，与普通加速度类似，我们在计算的时候也是先将其转换为角速度，再转换为角度。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vRotation</span> <span class="o">+=</span> <span class="nx">aRotation</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="c1">// 计算角速度</span>
<span class="nx">ship</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">vRotation</span> <span class="o">*</span> <span class="nx">deltaTime</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mi">180</span> <span class="c1">// 计算角度</span>
</code></pre></div></div>

<p>另外在示例中我们还引入了重力加速度的概念，重力加速度无非就是在 y 方向上计算速度时再引入一个加速度变量</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="mi">50</span>

<span class="p">...</span>

<span class="nx">vy</span> <span class="o">+=</span> <span class="nx">gravity</span> <span class="o">*</span> <span class="nx">deltaTime</span>
</code></pre></div></div>

<p>学习了速度与加速度的概念和计算方式，后续就可以开发更多的动画了！</p>
