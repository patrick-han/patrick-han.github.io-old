<ul id="markdown-toc">
  <li><a href="#画布充满窗口" id="markdown-toc-画布充满窗口">画布充满窗口</a></li>
  <li><a href="#resize" id="markdown-toc-resize">resize</a></li>
  <li><a href="#pixel-ratio-像素比" id="markdown-toc-pixel-ratio-像素比">pixel ratio 像素比</a></li>
  <li><a href="#全屏" id="markdown-toc-全屏">全屏</a></li>
  <li><a href="#小结" id="markdown-toc-小结">小结</a></li>
</ul>

<p>本系列为 <a href="https://threejs-journey.com/">Three.js journey</a> 教程学习笔记。</p>

<p>画布充满窗口，resize，像素比，双击全屏等功能</p>

<h1 id="画布充满窗口">画布充满窗口</h1>

<p>让画布充满窗口需要设置尺寸，可以使用 <code class="language-plaintext highlighter-rouge">window.innerWidth</code> 属性，同时移除 canvas 标签上设置的宽高</p>

<p>html 代码如下</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"ie=edge"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>08 fullscreenAndResizing<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">"mainCanvas"</span> <span class="na">class=</span><span class="s">"webgl"</span><span class="nt">&gt;&lt;/canvas&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"&lt;%= path %&gt;"</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>js 代码如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Size</span>
<span class="kd">const</span> <span class="nx">sizes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">width</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span>
  <span class="na">height</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>使用 <code class="language-plaintext highlighter-rouge">innerWidth, innerHeight</code> 获取视口的宽高。</p>

<p>同时需要设置一些标签的 CSS 属性，如下</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">html</span><span class="o">,</span>
<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span> <span class="c">/* 避免滚动时出现问题 */</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.webgl</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>这样我们的画布就完整的充满屏幕了</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN011jnNUh1CgsiTbgyrd_!!6000000000111-1-tps-395-679.gif" alt="" /></p>

<h1 id="resize">resize</h1>

<p>考虑到 resize 窗口时的处理，需要监听 resize 事件</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">resize</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// update sizes</span>
  <span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
  <span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

  <span class="c1">// update camera</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">aspect</span> <span class="o">=</span> <span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nf">updateProjectionMatrix</span><span class="p">()</span>

  <span class="c1">// update renderer</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01M3QBa41mTRG2mLEwa_!!6000000004955-1-tps-924-667.gif" alt="" /></p>

<p>在线 <a href="https://gaohaoyang.github.io/threeJourney08-fullscreenAndResizing/">demo 链接</a></p>

<p><a href="https://github.com/Gaohaoyang/threeJourney/tree/main/src08-fullscreenAndResizing">demo 源码</a></p>

<h1 id="pixel-ratio-像素比">pixel ratio 像素比</h1>

<p>可以看到屏幕上立方体的边缘出现了锯齿，这是像素比问题，我们可以通过设置像素比解决这个问题</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">renderer</span><span class="p">.</span><span class="nf">setPixelRatio</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>不需要设置过高，过高的像素比设定可能会带来性能问题，最大值设置为 2 已经能满足绝大部分场景了。</p>

<p>同时需要设置在 <code class="language-plaintext highlighter-rouge">resize</code> 事件中，因为有可能用户使用显示器连接多块像素比不同的屏幕，我们将页面拖动到另一个屏幕中时，需要赋予新的像素比</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">window.addEventListener('resize', () =&gt; {
</span>  // update sizes
  sizes.width = window.innerWidth
  sizes.height = window.innerHeight
<span class="err">
</span>  // update camera
  camera.aspect = sizes.width / sizes.height
  camera.updateProjectionMatrix()
<span class="err">
</span>  // update renderer
  renderer.setSize(sizes.width, sizes.height)
<span class="gi">+  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
</span>})
</code></pre></div></div>

<p>在线 <a href="https://gaohaoyang.github.io/threeJourney08-fullscreenAndResizing/">demo 链接</a></p>

<p><a href="https://github.com/Gaohaoyang/threeJourney/tree/main/src08-fullscreenAndResizing">demo 源码</a></p>

<h1 id="全屏">全屏</h1>

<p>用户一般习惯双击全屏，所以我们要监听双击事件</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dblclick</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">if </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">exitFullscreen</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nf">requestFullscreen</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>添加如上的代码，就完成了双击进入全屏，再次双击退出全屏。为了解决 safari 浏览器的兼容问题，需要加 <code class="language-plaintext highlighter-rouge">webkit</code> 前缀</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dblclick</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">fullscreenElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">webkitFullscreenElement</span>
  <span class="nf">if </span><span class="p">(</span><span class="nx">fullscreenElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">exitFullscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nf">exitFullscreen</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nf">webkitExitFullscreen</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">requestFullscreen</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nf">requestFullscreen</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nf">webkitRequestFullscreen</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>完整代码和 demo 如下</p>

<p>在线 <a href="https://gaohaoyang.github.io/threeJourney08-fullscreenAndResizing/">demo 链接</a></p>

<p><a href="https://github.com/Gaohaoyang/threeJourney/tree/main/src08-fullscreenAndResizing">demo 源码</a></p>

<h1 id="小结">小结</h1>

<p>本节我们学习了设置满屏画布、resize 时适配、高分辨率屏幕像素比、双击全屏等功能。下一节讲讲几何体。</p>

