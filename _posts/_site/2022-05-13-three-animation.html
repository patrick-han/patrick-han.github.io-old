<ul id="markdown-toc">
  <li><a href="#基于时间间隔" id="markdown-toc-基于时间间隔">基于时间间隔</a></li>
  <li><a href="#基于-three-内置的-clock" id="markdown-toc-基于-three-内置的-clock">基于 THREE 内置的 Clock</a>    <ul>
      <li><a href="#clockgetdelta-实现动画" id="markdown-toc-clockgetdelta-实现动画"><code class="language-plaintext highlighter-rouge">clock.getDelta()</code> 实现动画</a></li>
      <li><a href="#getelapsedtime-实现圆周运动" id="markdown-toc-getelapsedtime-实现圆周运动"><code class="language-plaintext highlighter-rouge">getElapsedTime()</code> 实现圆周运动</a>        <ul>
          <li><a href="#让相机总是指向方块" id="markdown-toc-让相机总是指向方块">让相机总是指向方块</a></li>
        </ul>
      </li>
      <li><a href="#使用-gsap-实现动画" id="markdown-toc-使用-gsap-实现动画">使用 GSAP 实现动画</a></li>
    </ul>
  </li>
  <li><a href="#小结" id="markdown-toc-小结">小结</a></li>
</ul>

<p>本系列为 <a href="https://threejs-journey.com/">Three.js journey</a> 教程学习笔记。</p>

<p>Animation 动画</p>

<p>Three.js 中的动画与其他 Canvas 动画类似，都是使用了 <code class="language-plaintext highlighter-rouge">requestAnimationFrame</code> api，接下来就详细讲讲基于时间间隔动画、Threejs 内置的时钟、以及第三方动画库</p>

<h1 id="基于时间间隔">基于时间间隔</h1>

<p>为了避免高刷屏上动画速度变快，我们需要把动画播放与时间关联，而非帧数关联。</p>

<p>可以使用 requestAnimationFrame 获取时间差，动画基于这个时间差</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>

<span class="c1">// Canvas</span>
<span class="kd">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span> <span class="k">as</span> <span class="nx">HTMLCanvasElement</span>

<span class="c1">// Scene</span>
<span class="kd">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Scene</span><span class="p">()</span>

<span class="c1">// Object</span>
<span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">BoxGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshBasicMaterial</span><span class="p">({</span>
    <span class="na">color</span><span class="p">:</span> <span class="mh">0xff0000</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">cube</span><span class="p">)</span>

<span class="c1">// Camera</span>
<span class="kd">const</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">PerspectiveCamera</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nf">lookAt</span><span class="p">(</span><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>

<span class="c1">// Renderer</span>
<span class="kd">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">WebGLRenderer</span><span class="p">({</span>
  <span class="nx">canvas</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>

<span class="c1">// Time</span>
<span class="kd">let</span> <span class="nx">time</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>

<span class="c1">// Animations</span>
<span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currentTime</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
  <span class="kd">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">time</span>
  <span class="nx">time</span> <span class="o">=</span> <span class="nx">currentTime</span>

  <span class="nx">cube</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="nx">deltaTime</span>

  <span class="c1">// Render</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">)</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">tick</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>效果如下：可以看到左上角的帧数为 144</p>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN01H1wK4125cZrNhDT7v_!!6000000007547-1-tps-774-559.gif" alt="" /></p>

<h1 id="基于-three-内置的-clock">基于 THREE 内置的 Clock</h1>

<h2 id="clockgetdelta-实现动画"><code class="language-plaintext highlighter-rouge">clock.getDelta()</code> 实现动画</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>

<span class="c1">// Canvas</span>
<span class="kd">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span> <span class="k">as</span> <span class="nx">HTMLCanvasElement</span>

<span class="c1">// Scene</span>
<span class="kd">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Scene</span><span class="p">()</span>

<span class="c1">// Object</span>
<span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">BoxGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshBasicMaterial</span><span class="p">({</span>
    <span class="na">color</span><span class="p">:</span> <span class="mh">0xff0000</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">cube</span><span class="p">)</span>

<span class="c1">// Camera</span>
<span class="kd">const</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">PerspectiveCamera</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nf">lookAt</span><span class="p">(</span><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>

<span class="c1">// Renderer</span>
<span class="kd">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">WebGLRenderer</span><span class="p">({</span>
  <span class="nx">canvas</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>

<span class="c1">// Clock</span>
<span class="kd">const</span> <span class="nx">clock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Clock</span><span class="p">()</span>

<span class="c1">// Animations</span>
<span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nx">clock</span><span class="p">.</span><span class="nf">getDelta</span><span class="p">()</span>

  <span class="nx">cube</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="nx">delta</span>

  <span class="c1">// Render</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">)</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">tick</span><span class="p">()</span>
</code></pre></div></div>

<p>效果同上一个 demo</p>

<p>关于 <a href="https://threejs.org/docs/index.html#api/zh/core/Clock">Clock 详见 threejs 文档</a></p>

<p>该对象用于跟踪时间。如果 performance.now 可用，则 Clock 对象通过该方法实现，否则回落到使用略欠精准的 Date.now 来实现。所以基于 three.js 内置的 Clock 理论上应该会比上一个示例更加精准</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">.getElapsedTime () : Float</code>
获取自时钟启动后的秒数，同时将 .oldTime 设置为当前时间。
如果 .autoStart 设置为 true 且时钟并未运行，则该方法同时启动时钟。</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">.getDelta () : Float</code>
获取自 .oldTime 设置后到当前的秒数。 同时将 .oldTime 设置为当前时间。
如果 .autoStart 设置为 true 且时钟并未运行，则该方法同时启动时钟。</p>
  </li>
</ul>

<h2 id="getelapsedtime-实现圆周运动"><code class="language-plaintext highlighter-rouge">getElapsedTime()</code> 实现圆周运动</h2>

<p>使用三角函数，可以让物体在三维空间做圆周运动</p>

<p>效果如下</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01TjqFGj1bmi9IsZHXa_!!6000000003508-1-tps-774-559.gif" alt="" /></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>

<span class="c1">// Canvas</span>
<span class="kd">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span> <span class="k">as</span> <span class="nx">HTMLCanvasElement</span>

<span class="c1">// Scene</span>
<span class="kd">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Scene</span><span class="p">()</span>

<span class="c1">// Object</span>
<span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">BoxGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshBasicMaterial</span><span class="p">({</span>
    <span class="na">color</span><span class="p">:</span> <span class="mh">0x607D8B</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">cube</span><span class="p">)</span>

<span class="c1">// Camera</span>
<span class="kd">const</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">PerspectiveCamera</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nf">lookAt</span><span class="p">(</span><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>

<span class="c1">// Renderer</span>
<span class="kd">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">WebGLRenderer</span><span class="p">({</span>
  <span class="nx">canvas</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>

<span class="c1">// Clock</span>
<span class="kd">const</span> <span class="nx">clock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Clock</span><span class="p">()</span>

<span class="c1">// Animations</span>
<span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">elapsedTime</span> <span class="o">=</span> <span class="nx">clock</span><span class="p">.</span><span class="nf">getElapsedTime</span><span class="p">()</span>

  <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
  <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>

  <span class="c1">// Render</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">)</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">tick</span><span class="p">()</span>
</code></pre></div></div>

<p>其中核心代码是这 2 行</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
<span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
</code></pre></div></div>

<p>当然我们也可以让物体不动，让相机运动出现的效果相同</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="让相机总是指向方块">让相机总是指向方块</h3>

<p>还可以让相机在圆周运动的同时总是指向物体，效果如下</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Animations</span>
<span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">elapsedTime</span> <span class="o">=</span> <span class="nx">clock</span><span class="p">.</span><span class="nf">getElapsedTime</span><span class="p">()</span>

  <span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">)</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nf">lookAt</span><span class="p">(</span><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>

  <span class="c1">// Render</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">)</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN016LKeoi1Z02piuD3Ut_!!6000000003131-1-tps-774-559.gif" alt="" /></p>

<h2 id="使用-gsap-实现动画">使用 GSAP 实现动画</h2>

<p>除了手写位移或三角函数实现动画外，也可以使用第三方库来实现，例如下个例子使用了 GSAP</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">gsap</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">gsap</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">stats</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../common/stats</span><span class="dl">'</span>

<span class="c1">// Canvas</span>
<span class="kd">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#mainCanvas</span><span class="dl">'</span><span class="p">)</span> <span class="k">as</span> <span class="nx">HTMLCanvasElement</span>

<span class="c1">// Scene</span>
<span class="kd">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Scene</span><span class="p">()</span>

<span class="c1">// Object</span>
<span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">BoxGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshBasicMaterial</span><span class="p">({</span>
    <span class="na">color</span><span class="p">:</span> <span class="mh">0x607d8b</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">)</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">cube</span><span class="p">)</span>

<span class="c1">// Camera</span>
<span class="kd">const</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">PerspectiveCamera</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nf">lookAt</span><span class="p">(</span><span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>

<span class="c1">// Renderer</span>
<span class="kd">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">WebGLRenderer</span><span class="p">({</span>
  <span class="nx">canvas</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span>

<span class="nx">gsap</span><span class="p">.</span><span class="nf">fromTo</span><span class="p">(</span>
  <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="na">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">x</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="na">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">yoyo</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">repeat</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="na">ease</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sine.inOut</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">)</span>

<span class="c1">// Animations</span>
<span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

  <span class="c1">// Render</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">)</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
  <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">tick</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01c9NKzu1a354heHmTI_!!6000000003273-1-tps-774-559.gif" alt="" /></p>

<p>在线 <a href="https://gaohaoyang.github.io/threeJourney/06-animation/">demo 链接</a></p>

<p><a href="https://github.com/Gaohaoyang/threeJourney/tree/main/src/06-animation">demo 源码</a></p>

<h1 id="小结">小结</h1>

<p>我们已经学习了解了几个实现 Three.js 动画的方法，什么场景选择什么方案并没有标准答案，这取决于你的项目你熟悉的库等等因素。大部分情况使用三角函数能够解决大部分问题，但对于复杂的动画，就需要依赖动画库了。</p>

<p>下一节将讲讲 Camera 相机。</p>
